/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => AliasFilenameHistoryPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  ignoreRegexes: ["^_", "^Untitled$", "^Untitled \\d+$"],
  timeoutSeconds: 5,
  caseSensitive: false,
  autoCreateFrontmatter: true,
  includeFolders: [],
  excludeFolders: [],
  fileExtensions: ["md"],
  trackFolderRenames: "",
  excludePropertyName: ""
};

// src/ui/settings-tab.ts
var import_obsidian2 = require("obsidian");

// src/utils/settings-compat.ts
var import_obsidian = require("obsidian");
var Obsidian = __toESM(require("obsidian"), 1);
function createSettingsGroup(containerEl, heading, manifestId) {
  if ((0, import_obsidian.requireApiVersion)("1.11.0")) {
    const ObsidianTyped = Obsidian;
    const SettingGroupCtor = ObsidianTyped.SettingGroup;
    const group = new SettingGroupCtor(containerEl);
    if (heading) {
      group.setHeading(heading);
    }
    return {
      addSetting(cb) {
        group.addSetting(cb);
      }
    };
  } else {
    if (manifestId) {
      containerEl.addClass(`${manifestId}-settings-compat`);
    }
    const groupEl = containerEl.createDiv("setting-group");
    if (heading) {
      const headingEl = groupEl.createDiv("setting-group-heading");
      headingEl.createEl("h3", { text: heading });
    }
    return {
      addSetting(cb) {
        const setting = new import_obsidian.Setting(groupEl);
        cb(setting);
      }
    };
  }
}

// src/ui/settings-tab.ts
var AliasFilenameHistorySettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const saveSettings = () => {
      void this.plugin.saveSettings();
    };
    const generalGroup = createSettingsGroup(containerEl, void 0, "alias-file-name-history");
    generalGroup.addSetting((setting) => {
      setting.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(
        (slider) => slider.setLimits(1, 20, 1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange((value) => {
          this.plugin.settings.timeoutSeconds = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Case-sensitive uniqueness").setDesc("If enabled, treat note and Note as different aliases.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.caseSensitive).onChange((value) => {
          this.plugin.settings.caseSensitive = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.autoCreateFrontmatter).onChange((value) => {
          this.plugin.settings.autoCreateFrontmatter = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(
        (text) => text.setPlaceholder("md, txt").setValue(this.plugin.settings.fileExtensions.join(",")).onChange((value) => {
          this.plugin.settings.fileExtensions = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    const filteringGroup = createSettingsGroup(containerEl, "Filtering", "alias-file-name-history");
    const foldersGroup = createSettingsGroup(containerEl, "Folders", "alias-file-name-history");
    const advancedGroup = createSettingsGroup(containerEl, "Advanced", "alias-file-name-history");
    filteringGroup.addSetting((setting) => {
      setting.setName("Ignore regex patterns").setDesc(
        "Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^untitled$ for untitled). Leave empty to disable."
      ).addText(
        (text) => text.setPlaceholder("^_, ^untitled$, ^untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange((value) => {
          this.plugin.settings.ignoreRegexes = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    filteringGroup.addSetting((setting) => {
      setting.setName("Exclude property name").setDesc(
        "Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering."
      ).addText(
        (text) => text.setPlaceholder("skip-rename-tracking").setValue(this.plugin.settings.excludePropertyName).onChange((value) => {
          this.plugin.settings.excludePropertyName = value;
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Include folders").setDesc(
        "Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders)."
      ).addText(
        (text) => text.setValue(this.plugin.settings.includeFolders.join(",")).onChange((value) => {
          this.plugin.settings.includeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Exclude folders").setDesc(
        'Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.'
      ).addText(
        (text) => text.setValue(this.plugin.settings.excludeFolders.join(",")).onChange((value) => {
          this.plugin.settings.excludeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    advancedGroup.addSetting((setting) => {
      setting.setName("Track folder renames for specific file name").setDesc(
        // eslint-disable-next-line obsidianmd/ui/sentence-case
        "If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed."
      ).addText(
        (text) => text.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange((value) => {
          this.plugin.settings.trackFolderRenames = value;
          saveSettings();
        })
      );
    });
  }
};

// src/utils/alias-processor.ts
var import_obsidian3 = require("obsidian");
var AliasProcessor = class {
  constructor(app, settings) {
    this.app = app;
    this.settings = settings;
  }
  async processAliasesManually(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) {
      return;
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    let content = await this.app.vault.read(file);
    const frontmatterRegex = /^---\n([\s\S]*?)\n---\n/;
    const match = content.match(frontmatterRegex);
    let frontmatter = {};
    let frontmatterText = "";
    let bodyContent = content;
    if (match) {
      frontmatterText = match[1];
      bodyContent = content.slice(match[0].length);
      try {
        const parsed = (0, import_obsidian3.parseYaml)(frontmatterText);
        frontmatter = parsed && typeof parsed === "object" ? parsed : {};
      } catch (e) {
        console.error(`Error parsing properties:`, e);
        frontmatter = {};
      }
    } else {
      bodyContent = content;
    }
    let aliases = frontmatter.aliases;
    if (!Array.isArray(aliases)) {
      const hasFrontmatter = Object.keys(frontmatter).length > 0;
      if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
        return;
      }
      aliases = [];
    }
    const aliasesArray = aliases;
    const existing = new Set(
      this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
    );
    let added = false;
    for (const name of toAdd) {
      const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
      if (!existing.has(checkName)) {
        aliasesArray.push(name);
        existing.add(checkName);
        added = true;
      }
    }
    if (!added) {
      return;
    }
    frontmatter.aliases = aliasesArray;
    const newFrontmatterText = (0, import_obsidian3.stringifyYaml)(frontmatter).trim();
    const newContent = `---
${newFrontmatterText}
---
${bodyContent}`;
    await this.app.vault.modify(file, newContent);
  }
  async processAliases(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file) return;
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0) {
      return;
    }
    if (file.extension !== "md") {
      await this.processAliasesManually(path, queue);
      return;
    }
    await this.app.fileManager.processFrontMatter(file, (fm) => {
      let aliases = fm.aliases;
      if (!Array.isArray(aliases)) {
        const hasFrontmatter = Object.keys(fm).length > 0;
        if (hasFrontmatter && !this.settings.autoCreateFrontmatter) {
          return;
        }
        aliases = [];
        fm.aliases = aliases;
      }
      const aliasesArray = aliases;
      const existing = new Set(
        this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
      );
      for (const name of toAdd) {
        const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
        if (!existing.has(checkName)) {
          aliasesArray.push(name);
          existing.add(checkName);
        }
      }
    });
  }
};

// src/utils/path-utils.ts
function getBasename(path) {
  const name = path.split("/").pop() || "";
  return name.replace(/\.[^/.]+$/, "");
}
function getImmediateParentName(path) {
  const parts = path.split("/");
  parts.pop();
  return parts.pop() || "";
}

// src/main.ts
var AliasFilenameHistoryPlugin = class extends import_obsidian4.Plugin {
  constructor() {
    super(...arguments);
    this.debounceMap = /* @__PURE__ */ new Map();
  }
  async onload() {
    await this.loadSettings();
    this.aliasProcessor = new AliasProcessor(this.app, this.settings);
    this.addSettingTab(new AliasFilenameHistorySettingTab(this.app, this));
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        this.handleRename(file, oldPath);
      })
    );
  }
  onunload() {
    for (const entry of this.debounceMap.values()) {
      if (entry.timeoutId !== 0) {
        window.clearTimeout(entry.timeoutId);
      }
    }
    this.debounceMap.clear();
  }
  async loadSettings() {
    const loadedData = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  isPathInFolder(path, folder) {
    if (folder.includes("{vault}") || folder.includes("{root}")) {
      const resolvedFolder = folder.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedFolder === "" || resolvedFolder === "/") {
        const isVaultRoot = !path.includes("/");
        return isVaultRoot;
      }
      return path.startsWith(resolvedFolder + "/") || path === resolvedFolder;
    }
    return path.startsWith(folder + "/") || path === folder;
  }
  isPathExcluded(path, excludePattern) {
    if (excludePattern.includes("{vault}") || excludePattern.includes("{root}")) {
      const resolvedPattern = excludePattern.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedPattern === "" || resolvedPattern === "/") {
        return !path.includes("/");
      }
      excludePattern = resolvedPattern;
    }
    if (excludePattern.endsWith("/**")) {
      const baseFolder = excludePattern.slice(0, -3);
      return path.startsWith(baseFolder + "/") || path === baseFolder;
    } else if (excludePattern.endsWith("/*")) {
      const baseFolder = excludePattern.slice(0, -2);
      if (!path.startsWith(baseFolder + "/")) {
        return path === baseFolder;
      }
      const pathAfterBase = path.slice(baseFolder.length + 1);
      return pathAfterBase.includes("/");
    }
    return path.startsWith(excludePattern + "/") || path === excludePattern;
  }
  handleRename(newFile, oldPath) {
    if (!(newFile instanceof import_obsidian4.TFile)) return;
    if (!this.settings.fileExtensions.includes(newFile.extension)) return;
    const oldBasename = getBasename(oldPath);
    const newBasename = newFile.basename;
    const oldImmediateParentName = getImmediateParentName(oldPath);
    const newImmediateParentName = getImmediateParentName(newFile.path);
    const isNameChange = this.settings.caseSensitive ? oldBasename !== newBasename : oldBasename.toLowerCase() !== newBasename.toLowerCase();
    const isFolderChange = oldImmediateParentName !== newImmediateParentName && !isNameChange;
    if (!isNameChange && !isFolderChange) {
      return;
    }
    const path = newFile.path;
    if (this.settings.excludePropertyName && this.settings.excludePropertyName.trim() !== "") {
      const cache = this.app.metadataCache.getFileCache(newFile);
      const frontmatter = cache == null ? void 0 : cache.frontmatter;
      if (frontmatter && frontmatter[this.settings.excludePropertyName] === true) {
        return;
      }
    }
    if (this.settings.includeFolders.length > 0) {
      if (!this.settings.includeFolders.some((f) => this.isPathInFolder(path, f))) {
        return;
      }
    }
    const isIndexFileForFolderRename = isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "" && (this.settings.caseSensitive ? newFile.basename === this.settings.trackFolderRenames : newFile.basename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase());
    for (const excludePattern of this.settings.excludeFolders) {
      if (this.isPathExcluded(path, excludePattern)) {
        if (isIndexFileForFolderRename && excludePattern.endsWith("/*") && !excludePattern.endsWith("/**")) {
          const baseFolder = excludePattern.slice(0, -2);
          if (path.startsWith(baseFolder + "/")) {
            const pathAfterBase = path.slice(baseFolder.length + 1);
            const pathParts = pathAfterBase.split("/");
            if (pathParts.length === 2) {
              continue;
            }
          }
        }
        return;
      }
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    let toQueue = null;
    if (isNameChange) {
      if (regexes.some((re) => re.test(oldBasename) || re.test(newBasename))) {
        return;
      }
      toQueue = oldBasename;
    } else if (isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "") {
      const currentBasename = newFile.basename;
      const matchesFilename = this.settings.caseSensitive ? currentBasename === this.settings.trackFolderRenames : currentBasename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase();
      if (!matchesFilename) {
        return;
      }
      if (oldImmediateParentName === "" || newImmediateParentName === "") {
        return;
      }
      if (regexes.some((re) => re.test(oldImmediateParentName) || re.test(newImmediateParentName))) {
        return;
      }
      toQueue = oldImmediateParentName;
    }
    if (!toQueue) return;
    let existingEntry = this.debounceMap.get(newFile.path);
    if (!existingEntry) {
      existingEntry = this.debounceMap.get(oldPath);
      if (existingEntry) {
        this.debounceMap.delete(oldPath);
      }
    }
    if (existingEntry) {
      if (existingEntry.timeoutId !== 0) {
        window.clearTimeout(existingEntry.timeoutId);
      }
      toQueue = Array.from(existingEntry.queue)[0];
    }
    const entry = {
      queue: /* @__PURE__ */ new Set([toQueue]),
      timeoutId: 0,
      currentPath: newFile.path
    };
    entry.timeoutId = window.setTimeout(() => {
      void (async () => {
        try {
          await this.aliasProcessor.processAliases(entry.currentPath, entry.queue);
        } catch (error) {
          console.error("Error processing aliases:", error);
        }
        this.debounceMap.delete(entry.currentPath);
      })();
    }, this.settings.timeoutSeconds * 1e3);
    this.debounceMap.set(newFile.path, entry);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9zZXR0aW5ncy10YWIudHMiLCAic3JjL3V0aWxzL3NldHRpbmdzLWNvbXBhdC50cyIsICJzcmMvdXRpbHMvYWxpYXMtcHJvY2Vzc29yLnRzIiwgInNyYy91dGlscy9wYXRoLXV0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIFRBYnN0cmFjdEZpbGUsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5nVGFiIH0gZnJvbSAnLi91aS9zZXR0aW5ncy10YWInO1xuaW1wb3J0IHsgQWxpYXNQcm9jZXNzb3IgfSBmcm9tICcuL3V0aWxzL2FsaWFzLXByb2Nlc3Nvcic7XG5pbXBvcnQgeyBnZXRCYXNlbmFtZSwgZ2V0SW1tZWRpYXRlUGFyZW50TmFtZSB9IGZyb20gJy4vdXRpbHMvcGF0aC11dGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XG4gIHByaXZhdGUgZGVib3VuY2VNYXA6IE1hcDxzdHJpbmcsIHsgcXVldWU6IFNldDxzdHJpbmc+OyB0aW1lb3V0SWQ6IG51bWJlcjsgY3VycmVudFBhdGg6IHN0cmluZyB9PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBhbGlhc1Byb2Nlc3NvcjogQWxpYXNQcm9jZXNzb3I7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgdGhpcy5hbGlhc1Byb2Nlc3NvciA9IG5ldyBBbGlhc1Byb2Nlc3Nvcih0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC52YXVsdC5vbigncmVuYW1lJywgKGZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZVJlbmFtZShmaWxlLCBvbGRQYXRoKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIC8vIENsZWFyIGFueSBwZW5kaW5nIHRpbWVvdXRzXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmRlYm91bmNlTWFwLnZhbHVlcygpKSB7XG4gICAgICBpZiAoZW50cnkudGltZW91dElkICE9PSAwKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoZW50cnkudGltZW91dElkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZWJvdW5jZU1hcC5jbGVhcigpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSAoYXdhaXQgdGhpcy5sb2FkRGF0YSgpKSBhcyBQYXJ0aWFsPEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M+IHwgbnVsbDtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgbG9hZGVkRGF0YSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoSW5Gb2xkZXIocGF0aDogc3RyaW5nLCBmb2xkZXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIEhhbmRsZSB2YXVsdCByb290IHZhcmlhYmxlXG4gICAgaWYgKGZvbGRlci5pbmNsdWRlcygne3ZhdWx0fScpIHx8IGZvbGRlci5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkRm9sZGVyID0gZm9sZGVyLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgLy8gSWYgdGhlIGZvbGRlciBpcyBqdXN0IHRoZSB2YXJpYWJsZSwgaXQgbWVhbnMgaW5jbHVkZSBvbmx5IHZhdWx0IHJvb3QgZmlsZXNcbiAgICAgIGlmIChyZXNvbHZlZEZvbGRlciA9PT0gJycgfHwgcmVzb2x2ZWRGb2xkZXIgPT09ICcvJykge1xuICAgICAgICAvLyBJbmNsdWRlIG9ubHkgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHZhdWx0IHJvb3QgKG5vIHN1YmZvbGRlcnMpXG4gICAgICAgIGNvbnN0IGlzVmF1bHRSb290ID0gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgICAgcmV0dXJuIGlzVmF1bHRSb290O1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlLCByZXBsYWNlIHRoZSB2YXJpYWJsZSBhbmQgY2hlY2sgbm9ybWFsbHlcbiAgICAgIHJldHVybiBwYXRoLnN0YXJ0c1dpdGgocmVzb2x2ZWRGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IHJlc29sdmVkRm9sZGVyO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3JtYWwgZm9sZGVyIG1hdGNoaW5nXG4gICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aChmb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGZvbGRlcjtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoRXhjbHVkZWQocGF0aDogc3RyaW5nLCBleGNsdWRlUGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gSGFuZGxlIHZhdWx0IHJvb3QgdmFyaWFibGVcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uaW5jbHVkZXMoJ3t2YXVsdH0nKSB8fCBleGNsdWRlUGF0dGVybi5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkUGF0dGVybiA9IGV4Y2x1ZGVQYXR0ZXJuLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgaWYgKHJlc29sdmVkUGF0dGVybiA9PT0gJycgfHwgcmVzb2x2ZWRQYXR0ZXJuID09PSAnLycpIHtcbiAgICAgICAgLy8gRXhjbHVkZSBvbmx5IGZpbGVzIGRpcmVjdGx5IGluIHRoZSB2YXVsdCByb290IChubyBzdWJmb2xkZXJzKVxuICAgICAgICByZXR1cm4gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgIH1cbiAgICAgIGV4Y2x1ZGVQYXR0ZXJuID0gcmVzb2x2ZWRQYXR0ZXJuO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSB3aWxkY2FyZHNcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uZW5kc1dpdGgoJy8qKicpKSB7XG4gICAgICAvLyBSZWN1cnNpdmUgZXhjbHVzaW9uOiBkb2NzLyoqIG1hdGNoZXMgZG9jcyBhbmQgYWxsIHN1YmZvbGRlcnNcbiAgICAgIGNvbnN0IGJhc2VGb2xkZXIgPSBleGNsdWRlUGF0dGVybi5zbGljZSgwLCAtMyk7XG4gICAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGJhc2VGb2xkZXI7XG4gICAgfSBlbHNlIGlmIChleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyonKSkge1xuICAgICAgLy8gRGlyZWN0IGNoaWxkcmVuIG9ubHk6IGRvY3MvKiBtYXRjaGVzIGRvY3Mvc3ViZm9sZGVyIGJ1dCBub3QgZG9jcy9zdWJmb2xkZXIvbmVzdGVkXG4gICAgICAvLyBTaG91bGQgZXhjbHVkZSBmaWxlcyBpbiBzdWJmb2xkZXJzLCBidXQgTk9UIGZpbGVzIGRpcmVjdGx5IGluIHRoZSBiYXNlIGZvbGRlclxuICAgICAgY29uc3QgYmFzZUZvbGRlciA9IGV4Y2x1ZGVQYXR0ZXJuLnNsaWNlKDAsIC0yKTtcbiAgICAgIGlmICghcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpKSB7XG4gICAgICAgIHJldHVybiBwYXRoID09PSBiYXNlRm9sZGVyO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0aEFmdGVyQmFzZSA9IHBhdGguc2xpY2UoYmFzZUZvbGRlci5sZW5ndGggKyAxKTtcbiAgICAgIC8vIEV4Y2x1ZGUgaWYgcGF0aCBpcyBpbiBhIHN1YmZvbGRlciAoaGFzIGF0IGxlYXN0IG9uZSBzbGFzaClcbiAgICAgIC8vIERvbid0IGV4Y2x1ZGUgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIGJhc2UgZm9sZGVyIChubyBzbGFzaClcbiAgICAgIHJldHVybiBwYXRoQWZ0ZXJCYXNlLmluY2x1ZGVzKCcvJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIE5vcm1hbCBmb2xkZXIgbWF0Y2hpbmdcbiAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGV4Y2x1ZGVQYXR0ZXJuICsgJy8nKSB8fCBwYXRoID09PSBleGNsdWRlUGF0dGVybjtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUmVuYW1lKG5ld0ZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykge1xuICAgIGlmICghKG5ld0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMuaW5jbHVkZXMobmV3RmlsZS5leHRlbnNpb24pKSByZXR1cm47XG5cbiAgICBjb25zdCBvbGRCYXNlbmFtZSA9IGdldEJhc2VuYW1lKG9sZFBhdGgpO1xuICAgIGNvbnN0IG5ld0Jhc2VuYW1lID0gbmV3RmlsZS5iYXNlbmFtZTtcbiAgICBjb25zdCBvbGRJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShvbGRQYXRoKTtcbiAgICBjb25zdCBuZXdJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShuZXdGaWxlLnBhdGgpO1xuXG4gICAgY29uc3QgaXNOYW1lQ2hhbmdlID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlXG4gICAgICA/IG9sZEJhc2VuYW1lICE9PSBuZXdCYXNlbmFtZVxuICAgICAgOiBvbGRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpICE9PSBuZXdCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGlzRm9sZGVyQ2hhbmdlID0gb2xkSW1tZWRpYXRlUGFyZW50TmFtZSAhPT0gbmV3SW1tZWRpYXRlUGFyZW50TmFtZSAmJiAhaXNOYW1lQ2hhbmdlO1xuXG4gICAgaWYgKCFpc05hbWVDaGFuZ2UgJiYgIWlzRm9sZGVyQ2hhbmdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGF0aCA9IG5ld0ZpbGUucGF0aDtcbiAgICBcbiAgICAvLyBBcHBseSBmaWx0ZXJpbmcgY2hlY2tzIHRvIGJvdGggZmlsZSBuYW1lIGNoYW5nZXMgYW5kIGZvbGRlciByZW5hbWVzXG4gICAgLy8gUHJpb3JpdHk6IFByb3BlcnR5IGV4Y2x1c2lvbiAtPiBJbmNsdWRlIGZvbGRlcnMgLT4gRXhjbHVkZSBmb2xkZXJzXG4gICAgXG4gICAgLy8gMS4gQ2hlY2sgcHJvcGVydHktYmFzZWQgZXhjbHVzaW9uIGZpcnN0IChoaWdoZXN0IHByaW9yaXR5KVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUgJiYgdGhpcy5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUobmV3RmlsZSk7XG4gICAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWVdID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybjsgLy8gRXhjbHVkZSB0aGlzIGZpbGVcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMi4gQ2hlY2sgaW5jbHVkZSBmb2xkZXJzIChpZiBpbmNsdWRlRm9sZGVycyBpcyBub3QgZW1wdHksIG9ubHkgaW5jbHVkZSB0aG9zZSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5pbmNsdWRlRm9sZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuc29tZShmID0+IHRoaXMuaXNQYXRoSW5Gb2xkZXIocGF0aCwgZikpKSB7XG4gICAgICAgIHJldHVybjsgLy8gTm90IGluIGFueSBpbmNsdWRlZCBmb2xkZXJcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMy4gQ2hlY2sgZXhjbHVkZSBmb2xkZXJzICh3aXRoIHdpbGRjYXJkIHN1cHBvcnQpXG4gICAgLy8gU3BlY2lhbCBjYXNlOiBpZiB0cmFja2luZyBmb2xkZXIgcmVuYW1lcyBmb3IgYSBzcGVjaWZpYyBmaWxlIG5hbWUsIGFsbG93IGl0IGV2ZW4gaW4gZXhjbHVkZWQgc3ViZm9sZGVyc1xuICAgIC8vIHVubGVzcyB1c2luZyByZWN1cnNpdmUgZXhjbHVzaW9uICgqKikgb3IgdGhlIGZpbGUgaXMgbmVzdGVkIGRlZXBlciB0aGFuIG9uZSBsZXZlbFxuICAgIGNvbnN0IGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lID0gaXNGb2xkZXJDaGFuZ2UgJiYgXG4gICAgICB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyAmJiBcbiAgICAgIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgXG4gICAgICAgID8gbmV3RmlsZS5iYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBuZXdGaWxlLmJhc2VuYW1lLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRvTG93ZXJDYXNlKCkpO1xuICAgIFxuICAgIGZvciAoY29uc3QgZXhjbHVkZVBhdHRlcm4gb2YgdGhpcy5zZXR0aW5ncy5leGNsdWRlRm9sZGVycykge1xuICAgICAgaWYgKHRoaXMuaXNQYXRoRXhjbHVkZWQocGF0aCwgZXhjbHVkZVBhdHRlcm4pKSB7XG4gICAgICAgIC8vIElmIHRoaXMgaXMgYW4gaW5kZXggZmlsZSBmb3IgZm9sZGVyIHJlbmFtZSB0cmFja2luZywgYW5kIHRoZSBwYXR0ZXJuIGlzIC8qIChub3QgLyoqKSxcbiAgICAgICAgLy8gYWxsb3cgaXQgdGhyb3VnaCBvbmx5IGlmIGl0J3MgaW4gYSBkaXJlY3QgY2hpbGQgZm9sZGVyIChvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgaWYgKGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lICYmIGV4Y2x1ZGVQYXR0ZXJuLmVuZHNXaXRoKCcvKicpICYmICFleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyoqJykpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlsZSBpcyBpbiBhIGRpcmVjdCBjaGlsZCAob25seSBvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgICBjb25zdCBiYXNlRm9sZGVyID0gZXhjbHVkZVBhdHRlcm4uc2xpY2UoMCwgLTIpO1xuICAgICAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoYmFzZUZvbGRlciArICcvJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhdGhBZnRlckJhc2UgPSBwYXRoLnNsaWNlKGJhc2VGb2xkZXIubGVuZ3RoICsgMSk7XG4gICAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSBwYXRoQWZ0ZXJCYXNlLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSdzIG9ubHkgb25lIHBhdGggcGFydCBiZWZvcmUgdGhlIGZpbGVuYW1lLCBpdCdzIGEgZGlyZWN0IGNoaWxkXG4gICAgICAgICAgICAvLyBwYXRoUGFydHMgd2lsbCBiZSBsaWtlIFsnc3ViZm9sZGVyJywgJ2ZpbGVuYW1lLm1kJ10gLSB3ZSB3YW50IGV4YWN0bHkgMiBwYXJ0c1xuICAgICAgICAgICAgaWYgKHBhdGhQYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBleGNsdXNpb24gLSBpdCdzIGEgZGlyZWN0IGNoaWxkIGluZGV4IGZpbGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuOyAvLyBFeGNsdWRlZCBieSBmb2xkZXIgcGF0dGVyblxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENoZWNrIGlnbm9yZSByZWdleGVzXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHJlZ2V4U3RyIG9mIHRoaXMuc2V0dGluZ3MuaWdub3JlUmVnZXhlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpZ25vcmUgcmVnZXg6ICR7cmVnZXhTdHJ9YCwgZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHRvUXVldWU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGlmIChpc05hbWVDaGFuZ2UpIHtcbiAgICAgIGlmIChyZWdleGVzLnNvbWUocmUgPT4gcmUudGVzdChvbGRCYXNlbmFtZSkgfHwgcmUudGVzdChuZXdCYXNlbmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRCYXNlbmFtZTtcbiAgICB9IGVsc2UgaWYgKGlzRm9sZGVyQ2hhbmdlICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGZpbGUgbmFtZSBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgbmFtZSAod2l0aG91dCBleHRlbnNpb24pXG4gICAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBuZXdGaWxlLmJhc2VuYW1lO1xuICAgICAgY29uc3QgbWF0Y2hlc0ZpbGVuYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlIFxuICAgICAgICA/IGN1cnJlbnRCYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMudG9Mb3dlckNhc2UoKTtcbiAgICAgIFxuICAgICAgaWYgKCFtYXRjaGVzRmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAob2xkSW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycgfHwgbmV3SW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG9sZEltbWVkaWF0ZVBhcmVudE5hbWUpIHx8IHJlLnRlc3QobmV3SW1tZWRpYXRlUGFyZW50TmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRJbW1lZGlhdGVQYXJlbnROYW1lO1xuICAgIH1cblxuICAgIGlmICghdG9RdWV1ZSkgcmV0dXJuO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhbHJlYWR5IGEgcGVuZGluZyB0aW1lb3V0IGZvciB0aGlzIGZpbGVcbiAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGJvdGggdGhlIG5ldyBwYXRoIGFuZCB0aGUgb2xkIHBhdGggc2luY2UgdGhlIGZpbGUgd2FzIGp1c3QgcmVuYW1lZFxuICAgIGxldCBleGlzdGluZ0VudHJ5ID0gdGhpcy5kZWJvdW5jZU1hcC5nZXQobmV3RmlsZS5wYXRoKTtcbiAgICBpZiAoIWV4aXN0aW5nRW50cnkpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYSB0aW1lb3V0IGZvciB0aGUgb2xkIHBhdGggKHRoZSBmaWxlIHdhcyBqdXN0IHJlbmFtZWQgZnJvbSB0aGVyZSlcbiAgICAgIGV4aXN0aW5nRW50cnkgPSB0aGlzLmRlYm91bmNlTWFwLmdldChvbGRQYXRoKTtcbiAgICAgIGlmIChleGlzdGluZ0VudHJ5KSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGVudHJ5IHNpbmNlIHdlJ3JlIHVwZGF0aW5nIGl0IHdpdGggdGhlIG5ldyBwYXRoXG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKG9sZFBhdGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXhpc3RpbmdFbnRyeSkge1xuICAgICAgLy8gRmlsZSB3YXMgcmVuYW1lZCBhZ2FpbiBiZWZvcmUgdGltZW91dCBleHBpcmVkIC0gY2FuY2VsIHRoZSBwcmV2aW91cyB0aW1lb3V0XG4gICAgICBpZiAoZXhpc3RpbmdFbnRyeS50aW1lb3V0SWQgIT09IDApIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChleGlzdGluZ0VudHJ5LnRpbWVvdXRJZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWUgZnJvbSB0aGUgcHJldmlvdXMgdGltZW91dCwgbm90IHRoZSB0ZW1wb3JhcnkgbmFtZVxuICAgICAgdG9RdWV1ZSA9IEFycmF5LmZyb20oZXhpc3RpbmdFbnRyeS5xdWV1ZSlbMF07IC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWVcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZW50cnkgdG8gdHJhY2sgdGhlIHRpbWVvdXRcbiAgICBjb25zdCBlbnRyeSA9IHsgXG4gICAgICBxdWV1ZTogbmV3IFNldDxzdHJpbmc+KFt0b1F1ZXVlXSksIFxuICAgICAgdGltZW91dElkOiAwLCBcbiAgICAgIGN1cnJlbnRQYXRoOiBuZXdGaWxlLnBhdGggXG4gICAgfTtcblxuICAgIC8vIFNldCB0aW1lb3V0IHRvIGFjdHVhbGx5IHN0b3JlIHRoZSBhbGlhcyBhZnRlciB0aGUgZGVib3VuY2UgcGVyaW9kXG4gICAgZW50cnkudGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxpYXNQcm9jZXNzb3IucHJvY2Vzc0FsaWFzZXMoZW50cnkuY3VycmVudFBhdGgsIGVudHJ5LnF1ZXVlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGFsaWFzZXM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKGVudHJ5LmN1cnJlbnRQYXRoKTtcbiAgICAgIH0pKCk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xuXG4gICAgdGhpcy5kZWJvdW5jZU1hcC5zZXQobmV3RmlsZS5wYXRoLCBlbnRyeSk7XG4gIH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3Mge1xyXG4gIGlnbm9yZVJlZ2V4ZXM6IHN0cmluZ1tdO1xyXG4gIHRpbWVvdXRTZWNvbmRzOiBudW1iZXI7XHJcbiAgY2FzZVNlbnNpdGl2ZTogYm9vbGVhbjtcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IGJvb2xlYW47XHJcbiAgaW5jbHVkZUZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBzdHJpbmdbXTtcclxuICBmaWxlRXh0ZW5zaW9uczogc3RyaW5nW107XHJcbiAgdHJhY2tGb2xkZXJSZW5hbWVzOiBzdHJpbmc7XHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncyA9IHtcclxuICBpZ25vcmVSZWdleGVzOiBbJ15fJywgJ15VbnRpdGxlZCQnLCAnXlVudGl0bGVkIFxcXFxkKyQnXSxcclxuICB0aW1lb3V0U2Vjb25kczogNSxcclxuICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSxcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IHRydWUsXHJcbiAgaW5jbHVkZUZvbGRlcnM6IFtdLFxyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBbXSxcclxuICBmaWxlRXh0ZW5zaW9uczogWydtZCddLFxyXG4gIHRyYWNrRm9sZGVyUmVuYW1lczogJycsXHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogJycsXHJcbn07IiwgImltcG9ydCB7IEFwcCwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdzIH0gZnJvbSAnLi4vc2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXR0aW5nc0dyb3VwIH0gZnJvbSAnLi4vdXRpbHMvc2V0dGluZ3MtY29tcGF0JztcclxuXHJcbmludGVyZmFjZSBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XHJcbiAgc2F2ZVNldHRpbmdzKCk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBwbHVnaW46IEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luO1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbikge1xyXG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgLy8gSGVscGVyIHRvIHNhdmUgc2V0dGluZ3Mgd2l0aG91dCByZXR1cm5pbmcgYSBwcm9taXNlXHJcbiAgICBjb25zdCBzYXZlU2V0dGluZ3MgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgIHZvaWQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGdlbmVyYWxHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsIHVuZGVmaW5lZCwgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcblxyXG4gICAgLy8gR2VuZXJhbCBiZWhhdmlvciBzZXR0aW5ncyAoZ3JvdXBlZCwgbm8gaGVhZGluZylcclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnVGltZW91dCBzZWNvbmRzJylcclxuICAgICAgICAuc2V0RGVzYygnVGltZSBpbiBzZWNvbmRzIHRoZSBuYW1lIG11c3QgYmUgc3RhYmxlIGJlZm9yZSBhZGRpbmcgYWxpYXNlcy4nKVxyXG4gICAgICAgIC5hZGRTbGlkZXIoKHNsaWRlcikgPT5cclxuICAgICAgICAgIHNsaWRlclxyXG4gICAgICAgICAgICAuc2V0TGltaXRzKDEsIDIwLCAxKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZW91dFNlY29uZHMpXHJcbiAgICAgICAgICAgIC5zZXREeW5hbWljVG9vbHRpcCgpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0Nhc2Utc2Vuc2l0aXZlIHVuaXF1ZW5lc3MnKVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvYnNpZGlhbm1kL3VpL3NlbnRlbmNlLWNhc2VcclxuICAgICAgICAuc2V0RGVzYygnSWYgZW5hYmxlZCwgdHJlYXQgbm90ZSBhbmQgTm90ZSBhcyBkaWZmZXJlbnQgYWxpYXNlcy4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdBdXRvLWNyZWF0ZSBwcm9wZXJ0aWVzJylcclxuICAgICAgICAuc2V0RGVzYygnQXV0b21hdGljYWxseSBjcmVhdGUgcHJvcGVydGllcyB3aXRoIGFsaWFzZXMgaWYgbWlzc2luZy4nKVxyXG4gICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRmlsZSBleHRlbnNpb25zJylcclxuICAgICAgICAuc2V0RGVzYygnQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZmlsZSBleHRlbnNpb25zIHRvIHRyYWNrLicpXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvYnNpZGlhbm1kL3VpL3NlbnRlbmNlLWNhc2VcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdtZCwgdHh0JylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbGVFeHRlbnNpb25zLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbGVFeHRlbnNpb25zID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJpbmdHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsICdGaWx0ZXJpbmcnLCAnYWxpYXMtZmlsZS1uYW1lLWhpc3RvcnknKTtcclxuICAgIGNvbnN0IGZvbGRlcnNHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsICdGb2xkZXJzJywgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcbiAgICBjb25zdCBhZHZhbmNlZEdyb3VwID0gY3JlYXRlU2V0dGluZ3NHcm91cChjb250YWluZXJFbCwgJ0FkdmFuY2VkJywgJ2FsaWFzLWZpbGUtbmFtZS1oaXN0b3J5Jyk7XHJcblxyXG4gICAgLy8gRmlsdGVyaW5nIHNldHRpbmdzXHJcbiAgICBmaWx0ZXJpbmdHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnSWdub3JlIHJlZ2V4IHBhdHRlcm5zJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgcmVnZXggcGF0dGVybnMgZm9yIGZpbGUgbmFtZXMgb3IgaW1tZWRpYXRlIHBhcmVudCBmb2xkZXIgbmFtZXMgdG8gaWdub3JlIChlLmcuLCBeXyBmb3IgdW5kZXJzY29yZSBwcmVmaXhlcywgXnVudGl0bGVkJCBmb3IgdW50aXRsZWQpLiBMZWF2ZSBlbXB0eSB0byBkaXNhYmxlLidcclxuICAgICAgICApXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignXl8sIF51bnRpdGxlZCQsIF51bnRpdGxlZCBcXFxcZCskJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWdub3JlUmVnZXhlcyA9IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy50cmltKCkpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzKTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZmlsdGVyaW5nR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0V4Y2x1ZGUgcHJvcGVydHkgbmFtZScpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAnTmFtZSBvZiBhIGJvb2xlYW4gcHJvcGVydHkgdG8gY2hlY2sgaW4gZmlsZXMuIEZpbGVzIHdpdGggdGhpcyBwcm9wZXJ0eSBzZXQgdG8gdHJ1ZSB3aWxsIGJlIGV4Y2x1ZGVkIGZyb20gdHJhY2tpbmcuIFRha2VzIHByaW9yaXR5IG92ZXIgZm9sZGVyIGZpbHRlcmluZy4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignc2tpcC1yZW5hbWUtdHJhY2tpbmcnKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZVByb3BlcnR5TmFtZSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRm9sZGVyIGluY2x1ZGUvZXhjbHVkZSBzZXR0aW5nc1xyXG4gICAgZm9sZGVyc0dyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdJbmNsdWRlIGZvbGRlcnMnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgJ0NvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIGZvbGRlciBwYXRocyB0byBpbmNsdWRlLiBJZiBlbXB0eSwgYWxsIGZvbGRlcnMgYXJlIGluY2x1ZGVkLiBVc2Uge3ZhdWx0fSBvciB7cm9vdH0gdG8gaW5jbHVkZSBvbmx5IGZpbGVzIGRpcmVjdGx5IGluIHRoZSB2YXVsdCByb290IChubyBzdWJmb2xkZXJzKS4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZvbGRlcnNHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnRXhjbHVkZSBmb2xkZXJzJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBmb2xkZXIgcGF0aHMgdG8gZXhjbHVkZS4gU3VwcG9ydHMgd2lsZGNhcmRzOiB1c2UgXCJmb2xkZXIvKlwiIHRvIGV4Y2x1ZGUgZGlyZWN0IGNoaWxkcmVuLCBcImZvbGRlci8qKlwiIHRvIGV4Y2x1ZGUgYWxsIGRlc2NlbmRhbnRzLiBVc2Uge3ZhdWx0fSBvciB7cm9vdH0gdG8gZXhjbHVkZSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdC4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZUZvbGRlcnMuam9pbignLCcpKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZUZvbGRlcnMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFkdmFuY2VkIC8gbmljaGUgb3B0aW9uc1xyXG4gICAgYWR2YW5jZWRHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnVHJhY2sgZm9sZGVyIHJlbmFtZXMgZm9yIHNwZWNpZmljIGZpbGUgbmFtZScpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgICAnSWYgYSBtYXJrZG93biBmaWxlIG1hdGNoZXMgdGhpcyBmaWxlIG5hbWUsIHN0b3JlIG9sZCBpbW1lZGlhdGUgcGFyZW50IGZvbGRlciBuYW1lcyBhcyBhbGlhc2VzIHdoZW4gcGFyZW50IGZvbGRlcnMgYXJlIHJlbmFtZWQuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG9ic2lkaWFubWQvdWkvc2VudGVuY2UtY2FzZVxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ2luZGV4JylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcylcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG59XHJcbiIsICIvKipcclxuICogQ29tcGF0aWJpbGl0eSB1dGlsaXRpZXMgZm9yIHNldHRpbmdzXHJcbiAqIFByb3ZpZGVzIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIFNldHRpbmdHcm91cCAocmVxdWlyZXMgQVBJIDEuMTEuMCspXHJcbiAqL1xyXG5pbXBvcnQgeyBTZXR0aW5nLCByZXF1aXJlQXBpVmVyc2lvbiB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0ICogYXMgT2JzaWRpYW4gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW50ZXJmYWNlIFNldHRpbmdHcm91cEluc3RhbmNlIHtcclxuICBzZXRIZWFkaW5nKGhlYWRpbmc6IHN0cmluZyk6IHZvaWQ7XHJcbiAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpOiB2b2lkO1xyXG59XHJcblxyXG4vKipcclxuICogSW50ZXJmYWNlIHRoYXQgd29ya3Mgd2l0aCBib3RoIFNldHRpbmdHcm91cCBhbmQgZmFsbGJhY2sgY29udGFpbmVyXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFNldHRpbmdzQ29udGFpbmVyIHtcclxuICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgc2V0dGluZ3MgY29udGFpbmVyIHRoYXQgdXNlcyBTZXR0aW5nR3JvdXAgaWYgYXZhaWxhYmxlIChBUEkgMS4xMS4wKyksXHJcbiAqIG90aGVyd2lzZSBmYWxscyBiYWNrIHRvIGNyZWF0aW5nIGEgaGVhZGluZyBhbmQgdXNpbmcgdGhlIGNvbnRhaW5lciBkaXJlY3RseS5cclxuICpcclxuICogVXNlcyByZXF1aXJlQXBpVmVyc2lvbignMS4xMS4wJykgdG8gY2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZS5cclxuICogVGhpcyBpcyB0aGUgb2ZmaWNpYWwgT2JzaWRpYW4gQVBJIG1ldGhvZCBmb3IgdmVyc2lvbiBjaGVja2luZy5cclxuICpcclxuICogQHBhcmFtIGNvbnRhaW5lckVsIC0gVGhlIGNvbnRhaW5lciBlbGVtZW50IGZvciBzZXR0aW5nc1xyXG4gKiBAcGFyYW0gaGVhZGluZyAtIFRoZSBoZWFkaW5nIHRleHQgZm9yIHRoZSBzZXR0aW5ncyBncm91cFxyXG4gKiBAcGFyYW0gbWFuaWZlc3RJZCAtIFRoZSBwbHVnaW4ncyBtYW5pZmVzdCBJRCBmb3IgQ1NTIHNjb3BpbmcgKHJlcXVpcmVkIGZvciBmYWxsYmFjayBtb2RlKVxyXG4gKiBAcmV0dXJucyBBIGNvbnRhaW5lciB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNldHRpbmdzR3JvdXAoXHJcbiAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LFxyXG4gIGhlYWRpbmc/OiBzdHJpbmcsXHJcbiAgbWFuaWZlc3RJZD86IHN0cmluZ1xyXG4pOiBTZXR0aW5nc0NvbnRhaW5lciB7XHJcbiAgLy8gQ2hlY2sgaWYgU2V0dGluZ0dyb3VwIGlzIGF2YWlsYWJsZSAoQVBJIDEuMTEuMCspXHJcbiAgLy8gcmVxdWlyZUFwaVZlcnNpb24gaXMgdGhlIG9mZmljaWFsIE9ic2lkaWFuIEFQSSBtZXRob2QgZm9yIHZlcnNpb24gY2hlY2tpbmdcclxuICBpZiAocmVxdWlyZUFwaVZlcnNpb24oJzEuMTEuMCcpKSB7XHJcbiAgICAvLyBVc2UgU2V0dGluZ0dyb3VwIC0gaXQncyBndWFyYW50ZWVkIHRvIGV4aXN0IGF0IHJ1bnRpbWUgaWYgcmVxdWlyZUFwaVZlcnNpb24gcmV0dXJucyB0cnVlLlxyXG4gICAgLy8gV2UgYWNjZXNzIGl0IHZpYSB0aGUgbmFtZXNwYWNlIGltcG9ydCB0byBhdm9pZCByZXF1aXJpbmcgdGhlIHR5cGUgaW4gb2xkZXIgQVBJIGQudHMgZmlsZXMuXHJcbiAgICB0eXBlIE9ic2lkaWFuV2l0aFNldHRpbmdHcm91cCA9IHR5cGVvZiBPYnNpZGlhbiAmIHtcclxuICAgICAgU2V0dGluZ0dyb3VwOiBuZXcgKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCkgPT4gU2V0dGluZ0dyb3VwSW5zdGFuY2U7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgT2JzaWRpYW5UeXBlZCA9IE9ic2lkaWFuIGFzIHVua25vd24gYXMgT2JzaWRpYW5XaXRoU2V0dGluZ0dyb3VwO1xyXG4gICAgY29uc3QgU2V0dGluZ0dyb3VwQ3RvciA9IE9ic2lkaWFuVHlwZWQuU2V0dGluZ0dyb3VwO1xyXG4gICAgY29uc3QgZ3JvdXAgPSBuZXcgU2V0dGluZ0dyb3VwQ3Rvcihjb250YWluZXJFbCk7XHJcbiAgICBpZiAoaGVhZGluZykge1xyXG4gICAgICBncm91cC5zZXRIZWFkaW5nKGhlYWRpbmcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpIHtcclxuICAgICAgICBncm91cC5hZGRTZXR0aW5nKGNiKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIEZhbGxiYWNrIHBhdGggKGVpdGhlciBBUEkgPCAxLjExLjAgb3IgU2V0dGluZ0dyb3VwIG5vdCBmb3VuZClcclxuICAgIC8vIEFkZCBzY29waW5nIGNsYXNzIHRvIGNvbnRhaW5lckVsIHRvIHNjb3BlIENTUyB0byBvbmx5IHRoaXMgcGx1Z2luJ3Mgc2V0dGluZ3NcclxuICAgIGlmIChtYW5pZmVzdElkKSB7XHJcbiAgICAgIGNvbnRhaW5lckVsLmFkZENsYXNzKGAke21hbmlmZXN0SWR9LXNldHRpbmdzLWNvbXBhdGApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGYWxsYmFjazogY3JlYXRlIGEgZGVkaWNhdGVkIGNvbnRhaW5lciB0byBrZWVwIGhlYWRpbmcgKyBzZXR0aW5ncyB0b2dldGhlclxyXG4gICAgY29uc3QgZ3JvdXBFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignc2V0dGluZy1ncm91cCcpO1xyXG4gICAgaWYgKGhlYWRpbmcpIHtcclxuICAgICAgY29uc3QgaGVhZGluZ0VsID0gZ3JvdXBFbC5jcmVhdGVEaXYoJ3NldHRpbmctZ3JvdXAtaGVhZGluZycpO1xyXG4gICAgICBoZWFkaW5nRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiBoZWFkaW5nIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZyA9IG5ldyBTZXR0aW5nKGdyb3VwRWwpO1xyXG4gICAgICAgIGNiKHNldHRpbmcpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4iLCAiaW1wb3J0IHsgQXBwLCBzdHJpbmdpZnlZYW1sLCBwYXJzZVlhbWwgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQWxpYXNQcm9jZXNzb3Ige1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhcHA6IEFwcCxcclxuICAgIHByaXZhdGUgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3NcclxuICApIHt9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0FsaWFzZXNNYW51YWxseShwYXRoOiBzdHJpbmcsIHF1ZXVlOiBTZXQ8c3RyaW5nPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVCeVBhdGgocGF0aCk7XHJcbiAgICBpZiAoIWZpbGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlZ2V4ZXM6IFJlZ0V4cFtdID0gW107XHJcbiAgICBmb3IgKGNvbnN0IHJlZ2V4U3RyIG9mIHRoaXMuc2V0dGluZ3MuaWdub3JlUmVnZXhlcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlZ2V4ZXMucHVzaChuZXcgUmVnRXhwKHJlZ2V4U3RyKSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIGlnbm9yZSByZWdleDogJHtyZWdleFN0cn1gLCBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRvQWRkOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgY3VycmVudEJhc2VuYW1lID0gZmlsZS5iYXNlbmFtZTtcclxuICAgIGNvbnN0IGN1cnJlbnRCYXNlbmFtZUxvd2VyID0gY3VycmVudEJhc2VuYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgZm9yIChjb25zdCBuYW1lIG9mIHF1ZXVlKSB7XHJcbiAgICAgIGlmIChyZWdleGVzLnNvbWUocmUgPT4gcmUudGVzdChuYW1lKSkpIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBuYW1lTG93ZXIgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGlmIChcclxuICAgICAgICAodGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlICYmIG5hbWUgPT09IGN1cnJlbnRCYXNlbmFtZSkgfHxcclxuICAgICAgICAoIXRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSAmJiBuYW1lTG93ZXIgPT09IGN1cnJlbnRCYXNlbmFtZUxvd2VyKVxyXG4gICAgICApIHtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG4gICAgICB0b0FkZC5wdXNoKG5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0b0FkZC5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlYWQgZmlsZSBjb250ZW50XHJcbiAgICBsZXQgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XHJcblxyXG4gICAgLy8gUGFyc2UgZnJvbnRtYXR0ZXJcclxuICAgIGNvbnN0IGZyb250bWF0dGVyUmVnZXggPSAvXi0tLVxcbihbXFxzXFxTXSo/KVxcbi0tLVxcbi87XHJcbiAgICBjb25zdCBtYXRjaCA9IGNvbnRlbnQubWF0Y2goZnJvbnRtYXR0ZXJSZWdleCk7XHJcblxyXG4gICAgbGV0IGZyb250bWF0dGVyOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xyXG4gICAgbGV0IGZyb250bWF0dGVyVGV4dCA9ICcnO1xyXG4gICAgbGV0IGJvZHlDb250ZW50ID0gY29udGVudDtcclxuXHJcbiAgICBpZiAobWF0Y2gpIHtcclxuICAgICAgZnJvbnRtYXR0ZXJUZXh0ID0gbWF0Y2hbMV07XHJcbiAgICAgIGJvZHlDb250ZW50ID0gY29udGVudC5zbGljZShtYXRjaFswXS5sZW5ndGgpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlWWFtbChmcm9udG1hdHRlclRleHQpIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgbnVsbCB8IHVuZGVmaW5lZDtcclxuICAgICAgICBmcm9udG1hdHRlciA9IHBhcnNlZCAmJiB0eXBlb2YgcGFyc2VkID09PSAnb2JqZWN0JyA/IHBhcnNlZCA6IHt9O1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcGFyc2luZyBwcm9wZXJ0aWVzOmAsIGUpO1xyXG4gICAgICAgIGZyb250bWF0dGVyID0ge307XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJvZHlDb250ZW50ID0gY29udGVudDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgb3IgY3JlYXRlIGFsaWFzZXMgYXJyYXlcclxuICAgIGxldCBhbGlhc2VzID0gZnJvbnRtYXR0ZXIuYWxpYXNlcztcclxuICAgIGlmICghQXJyYXkuaXNBcnJheShhbGlhc2VzKSkge1xyXG4gICAgICBjb25zdCBoYXNGcm9udG1hdHRlciA9IE9iamVjdC5rZXlzKGZyb250bWF0dGVyKS5sZW5ndGggPiAwO1xyXG4gICAgICBpZiAoaGFzRnJvbnRtYXR0ZXIgJiYgIXRoaXMuc2V0dGluZ3MuYXV0b0NyZWF0ZUZyb250bWF0dGVyKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGFsaWFzZXMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhbGlhc2VzQXJyYXkgPSBhbGlhc2VzIGFzIHN0cmluZ1tdO1xyXG4gICAgY29uc3QgZXhpc3RpbmcgPSBuZXcgU2V0PHN0cmluZz4oXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSA/IGFsaWFzZXNBcnJheSA6IGFsaWFzZXNBcnJheS5tYXAoKGE6IHN0cmluZykgPT4gYS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgKTtcclxuXHJcbiAgICBsZXQgYWRkZWQgPSBmYWxzZTtcclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiB0b0FkZCkge1xyXG4gICAgICBjb25zdCBjaGVja05hbWUgPSB0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgPyBuYW1lIDogbmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAoIWV4aXN0aW5nLmhhcyhjaGVja05hbWUpKSB7XHJcbiAgICAgICAgYWxpYXNlc0FycmF5LnB1c2gobmFtZSk7XHJcbiAgICAgICAgZXhpc3RpbmcuYWRkKGNoZWNrTmFtZSk7XHJcbiAgICAgICAgYWRkZWQgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhZGRlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBkYXRlIGZyb250bWF0dGVyXHJcbiAgICBmcm9udG1hdHRlci5hbGlhc2VzID0gYWxpYXNlc0FycmF5O1xyXG5cclxuICAgIC8vIFN0cmluZ2lmeSBmcm9udG1hdHRlclxyXG4gICAgY29uc3QgbmV3RnJvbnRtYXR0ZXJUZXh0ID0gc3RyaW5naWZ5WWFtbChmcm9udG1hdHRlcikudHJpbSgpO1xyXG5cclxuICAgIC8vIFJlY29uc3RydWN0IGZpbGUgY29udGVudFxyXG4gICAgY29uc3QgbmV3Q29udGVudCA9IGAtLS1cXG4ke25ld0Zyb250bWF0dGVyVGV4dH1cXG4tLS1cXG4ke2JvZHlDb250ZW50fWA7XHJcblxyXG4gICAgLy8gV3JpdGUgYmFjayB0byBmaWxlXHJcbiAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5tb2RpZnkoZmlsZSwgbmV3Q29udGVudCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBwcm9jZXNzQWxpYXNlcyhwYXRoOiBzdHJpbmcsIHF1ZXVlOiBTZXQ8c3RyaW5nPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVCeVBhdGgocGF0aCk7XHJcbiAgICBpZiAoIWZpbGUpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCByZWdleGVzOiBSZWdFeHBbXSA9IFtdO1xyXG4gICAgZm9yIChjb25zdCByZWdleFN0ciBvZiB0aGlzLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZWdleGVzLnB1c2gobmV3IFJlZ0V4cChyZWdleFN0cikpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpZ25vcmUgcmVnZXg6ICR7cmVnZXhTdHJ9YCwgZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b0FkZDogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IGN1cnJlbnRCYXNlbmFtZSA9IGZpbGUuYmFzZW5hbWU7XHJcbiAgICBjb25zdCBjdXJyZW50QmFzZW5hbWVMb3dlciA9IGN1cnJlbnRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiBxdWV1ZSkge1xyXG4gICAgICBpZiAocmVnZXhlcy5zb21lKHJlID0+IHJlLnRlc3QobmFtZSkpKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgbmFtZUxvd2VyID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgKHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSAmJiBuYW1lID09PSBjdXJyZW50QmFzZW5hbWUpIHx8XHJcbiAgICAgICAgKCF0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgJiYgbmFtZUxvd2VyID09PSBjdXJyZW50QmFzZW5hbWVMb3dlcilcclxuICAgICAgKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgdG9BZGQucHVzaChuYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodG9BZGQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVc2UgbWFudWFsIHByb2Nlc3NpbmcgZm9yIG5vbi1tZCBmaWxlcywgb3IgYXMgZmFsbGJhY2tcclxuICAgIGlmIChmaWxlLmV4dGVuc2lvbiAhPT0gJ21kJykge1xyXG4gICAgICBhd2FpdCB0aGlzLnByb2Nlc3NBbGlhc2VzTWFudWFsbHkocGF0aCwgcXVldWUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucHJvY2Vzc0Zyb250TWF0dGVyKGZpbGUsIChmbTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pID0+IHtcclxuICAgICAgbGV0IGFsaWFzZXMgPSBmbS5hbGlhc2VzO1xyXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWxpYXNlcykpIHtcclxuICAgICAgICAvLyBJZiB0aGVyZSdzIG5vIGZyb250bWF0dGVyIGF0IGFsbCwgd2UgbmVlZCB0byBjcmVhdGUgaXQgdG8gYWRkIGFsaWFzZXNcclxuICAgICAgICAvLyBJZiB0aGVyZSdzIGZyb250bWF0dGVyIGJ1dCBubyBhbGlhc2VzIHByb3BlcnR5LCByZXNwZWN0IHRoZSBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXIgc2V0dGluZ1xyXG4gICAgICAgIGNvbnN0IGhhc0Zyb250bWF0dGVyID0gT2JqZWN0LmtleXMoZm0pLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgaWYgKGhhc0Zyb250bWF0dGVyICYmICF0aGlzLnNldHRpbmdzLmF1dG9DcmVhdGVGcm9udG1hdHRlcikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhbGlhc2VzID0gW107XHJcbiAgICAgICAgZm0uYWxpYXNlcyA9IGFsaWFzZXM7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGFsaWFzZXNBcnJheSA9IGFsaWFzZXMgYXMgc3RyaW5nW107XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbmV3IFNldDxzdHJpbmc+KFxyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSA/IGFsaWFzZXNBcnJheSA6IGFsaWFzZXNBcnJheS5tYXAoKGE6IHN0cmluZykgPT4gYS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHRvQWRkKSB7XHJcbiAgICAgICAgY29uc3QgY2hlY2tOYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlID8gbmFtZSA6IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAoIWV4aXN0aW5nLmhhcyhjaGVja05hbWUpKSB7XHJcbiAgICAgICAgICBhbGlhc2VzQXJyYXkucHVzaChuYW1lKTtcclxuICAgICAgICAgIGV4aXN0aW5nLmFkZChjaGVja05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsICJleHBvcnQgZnVuY3Rpb24gZ2V0QmFzZW5hbWUocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBuYW1lID0gcGF0aC5zcGxpdCgnLycpLnBvcCgpIHx8ICcnO1xyXG4gIHJldHVybiBuYW1lLnJlcGxhY2UoL1xcLlteLy5dKyQvLCAnJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRJbW1lZGlhdGVQYXJlbnROYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7XHJcbiAgcGFydHMucG9wKCk7IC8vIFJlbW92ZSBmaWxlIG5hbWVcclxuICByZXR1cm4gcGFydHMucG9wKCkgfHwgJyc7IC8vIEdldCBpbW1lZGlhdGUgcGFyZW50IGZvbGRlciBuYW1lIG9yICcnIGlmIHJvb3RcclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUE2Qzs7O0FDWXRDLElBQU0sbUJBQWlEO0FBQUEsRUFDNUQsZUFBZSxDQUFDLE1BQU0sY0FBYyxpQkFBaUI7QUFBQSxFQUNyRCxnQkFBZ0I7QUFBQSxFQUNoQixlQUFlO0FBQUEsRUFDZix1QkFBdUI7QUFBQSxFQUN2QixnQkFBZ0IsQ0FBQztBQUFBLEVBQ2pCLGdCQUFnQixDQUFDO0FBQUEsRUFDakIsZ0JBQWdCLENBQUMsSUFBSTtBQUFBLEVBQ3JCLG9CQUFvQjtBQUFBLEVBQ3BCLHFCQUFxQjtBQUN2Qjs7O0FDdEJBLElBQUFDLG1CQUE4Qzs7O0FDSTlDLHNCQUEyQztBQUMzQyxlQUEwQjtBQTBCbkIsU0FBUyxvQkFDZCxhQUNBLFNBQ0EsWUFDbUI7QUFHbkIsVUFBSSxtQ0FBa0IsUUFBUSxHQUFHO0FBTS9CLFVBQU0sZ0JBQWdCO0FBQ3RCLFVBQU0sbUJBQW1CLGNBQWM7QUFDdkMsVUFBTSxRQUFRLElBQUksaUJBQWlCLFdBQVc7QUFDOUMsUUFBSSxTQUFTO0FBQ1gsWUFBTSxXQUFXLE9BQU87QUFBQSxJQUMxQjtBQUNBLFdBQU87QUFBQSxNQUNMLFdBQVcsSUFBZ0M7QUFDekMsY0FBTSxXQUFXLEVBQUU7QUFBQSxNQUNyQjtBQUFBLElBQ0Y7QUFBQSxFQUNGLE9BQU87QUFHTCxRQUFJLFlBQVk7QUFDZCxrQkFBWSxTQUFTLEdBQUcsVUFBVSxrQkFBa0I7QUFBQSxJQUN0RDtBQUdBLFVBQU0sVUFBVSxZQUFZLFVBQVUsZUFBZTtBQUNyRCxRQUFJLFNBQVM7QUFDWCxZQUFNLFlBQVks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QUFLLHNCQUFzQixDQUFDLEdBQUc7QUFDMUY7QUFBQSxNQUNGO0FBQ0EsZ0JBQVU7QUFBQSxJQUNaO0FBRUEsUUFBSSxDQUFDLFFBQVM7QUFJZCxRQUFJLGdCQUFnQixLQUFLLFlBQVksSUFBSSxRQUFRLElBQUk7QUFDckQsUUFBSSxDQUFDLGVBQWU7QUFFbEIsc0JBQWdCLEtBQUssWUFBWSxJQUFJLE9BQU87QUFDNUMsVUFBSSxlQUFlO0FBRWpCLGFBQUssWUFBWSxPQUFPLE9BQU87QUFBQSxNQUNqQztBQUFBLElBQ0Y7QUFFQSxRQUFJLGVBQWU7QUFFakIsVUFBSSxjQUFjLGNBQWMsR0FBRztBQUNqQyxlQUFPLGFBQWEsY0FBYyxTQUFTO0FBQUEsTUFDN0M7QUFHQSxnQkFBVSxNQUFNLEtBQUssY0FBYyxLQUFLLEVBQUUsQ0FBQztBQUFBLElBQzdDO0FBR0EsVUFBTSxRQUFRO0FBQUEsTUFDWixPQUFPLG9CQUFJLElBQVksQ0FBQyxPQUFPLENBQUM7QUFBQSxNQUNoQyxXQUFXO0FBQUEsTUFDWCxhQUFhLFFBQVE7QUFBQSxJQUN2QjtBQUdBLFVBQU0sWUFBWSxPQUFPLFdBQVcsTUFBTTtBQUN4QyxZQUFNLFlBQVk7QUFDaEIsWUFBSTtBQUNGLGdCQUFNLEtBQUssZUFBZSxlQUFlLE1BQU0sYUFBYSxNQUFNLEtBQUs7QUFBQSxRQUN6RSxTQUFTLE9BQU87QUFDZCxrQkFBUSxNQUFNLDZCQUE2QixLQUFLO0FBQUEsUUFDbEQ7QUFDQSxhQUFLLFlBQVksT0FBTyxNQUFNLFdBQVc7QUFBQSxNQUMzQyxHQUFHO0FBQUEsSUFDTCxHQUFHLEtBQUssU0FBUyxpQkFBaUIsR0FBSTtBQUV0QyxTQUFLLFlBQVksSUFBSSxRQUFRLE1BQU0sS0FBSztBQUFBLEVBQzFDO0FBQ0Y7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
